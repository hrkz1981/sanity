<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ©ã‚¯ãƒå•†å“æƒ…å ±å–å¾—ãƒ„ãƒ¼ãƒ«</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen py-8">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900">ğŸ” ãƒ©ã‚¯ãƒå•†å“æƒ…å ±å–å¾—ãƒ„ãƒ¼ãƒ«</h1>
                <p class="mt-2 text-gray-600">
                    ãƒ©ã‚¯ãƒã®å•†å“URLã‹ã‚‰å•†å“æƒ…å ±ã‚’è‡ªå‹•å–å¾—ã—ã¦ã‚µã‚¤ãƒˆã«è¡¨ç¤ºã—ã¾ã™
                </p>
            </div>

            <!-- URLå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <form id="scrapeForm" class="space-y-4">
                    <div>
                        <label for="url" class="block text-sm font-medium text-gray-700 mb-2">
                            ãƒ©ã‚¯ãƒå•†å“URL
                        </label>
                        <input
                            type="url"
                            id="url"
                            placeholder="https://fril.jp/item/... ã¾ãŸã¯ https://rakuma.rakuten.co.jp/item/..."
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                            required
                        />
                        <p class="mt-1 text-sm text-gray-500">
                            ä¾‹: https://fril.jp/item/abc123def456 ã¾ãŸã¯ https://rakuma.rakuten.co.jp/item/xxx
                        </p>
                    </div>
                    
                    <button
                        type="submit"
                        id="scrapeBtn"
                        class="w-full bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                    >
                        ğŸ” å•†å“æƒ…å ±ã‚’å–å¾—
                    </button>
                </form>

                <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
                <div id="errorDiv" class="hidden mt-4 p-4 bg-red-50 border border-red-200 rounded-md">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p id="errorText" class="text-sm text-red-700"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å–å¾—ã—ãŸå•†å“æƒ…å ±ã®è¡¨ç¤º -->
            <div id="productResult" class="hidden bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-start mb-6">
                    <h2 class="text-xl font-semibold text-gray-900">âœ… å–å¾—ã—ãŸå•†å“æƒ…å ±</h2>
                    <button
                        id="addToSiteBtn"
                        class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2"
                    >
                        ğŸ›ï¸ ã‚µã‚¤ãƒˆã«è¿½åŠ 
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- å•†å“ç”»åƒ -->
                    <div>
                        <div id="imageContainer" class="relative aspect-square rounded-lg overflow-hidden bg-gray-100">
                            <img id="productImage" class="w-full h-full object-cover" alt="å•†å“ç”»åƒ">
                            <div id="noImagePlaceholder" class="hidden w-full h-full flex items-center justify-center">
                                <span class="text-gray-400">ğŸ“· ç”»åƒãªã—</span>
                            </div>
                        </div>
                    </div>

                    <!-- å•†å“è©³ç´° -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">å•†å“å</label>
                            <p id="productTitle" class="mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-md"></p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">ä¾¡æ ¼</label>
                            <p id="productPrice" class="mt-1 text-lg font-bold text-gray-900 bg-gray-50 p-3 rounded-md"></p>
                        </div>

                        <div id="brandContainer" class="hidden">
                            <label class="block text-sm font-medium text-gray-700">ãƒ–ãƒ©ãƒ³ãƒ‰</label>
                            <p id="productBrand" class="mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-md"></p>
                        </div>

                        <div id="conditionContainer" class="hidden">
                            <label class="block text-sm font-medium text-gray-700">å•†å“ã®çŠ¶æ…‹</label>
                            <p id="productCondition" class="mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-md"></p>
                        </div>

                        <div id="descriptionContainer" class="hidden">
                            <label class="block text-sm font-medium text-gray-700">èª¬æ˜</label>
                            <p id="productDescription" class="mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-md max-h-32 overflow-y-auto"></p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">å–å¾—å…ƒ</label>
                            <p id="productSource" class="mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded-md">ãƒ©ã‚¯ãƒ</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä½¿ç”¨æ–¹æ³• -->
            <div class="mt-8 bg-blue-50 border border-blue-200 rounded-md p-4">
                <h3 class="text-sm font-medium text-blue-800 mb-2">ğŸ“ ä½¿ç”¨æ–¹æ³•</h3>
                <ol class="text-sm text-blue-700 space-y-1">
                    <li>1. ãƒ©ã‚¯ãƒã®å•†å“ãƒšãƒ¼ã‚¸ã‚’é–‹ã</li>
                    <li>2. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã‹ã‚‰URLã‚’ã‚³ãƒ”ãƒ¼</li>
                    <li>3. ä¸Šè¨˜ãƒ•ã‚©ãƒ¼ãƒ ã«URLã‚’è²¼ã‚Šä»˜ã‘</li>
                    <li>4. ã€Œå•†å“æƒ…å ±ã‚’å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                    <li>5. å–å¾—ã•ã‚ŒãŸæƒ…å ±ã‚’ç¢ºèª</li>
                    <li>6. ã€Œã‚µã‚¤ãƒˆã«è¿½åŠ ã€ã§å•†å“ã‚’ã‚µã‚¤ãƒˆã«è¿½åŠ ï¼ˆãƒ‡ãƒ¢ï¼‰</li>
                </ol>
            </div>

            <!-- ã‚µãƒ³ãƒ—ãƒ«URL -->
            <div class="mt-4 bg-yellow-50 border border-yellow-200 rounded-md p-4">
                <h3 class="text-sm font-medium text-yellow-800 mb-2">ğŸ”— ãƒ†ã‚¹ãƒˆç”¨ã‚µãƒ³ãƒ—ãƒ«URL</h3>
                <p class="text-sm text-yellow-700 mb-2">ä»¥ä¸‹ã®ãƒœã‚¿ãƒ³ã§ã‚µãƒ³ãƒ—ãƒ«URLã‚’å…¥åŠ›ã§ãã¾ã™ï¼š</p>
                <div class="flex flex-wrap gap-2">
                    <button onclick="setTestUrl('https://fril.jp/item/sample1')" class="px-3 py-1 bg-yellow-200 text-yellow-800 rounded text-xs">
                        ã‚µãƒ³ãƒ—ãƒ«1
                    </button>
                    <button onclick="setTestUrl('https://rakuma.rakuten.co.jp/item/sample2')" class="px-3 py-1 bg-yellow-200 text-yellow-800 rounded text-xs">
                        ã‚µãƒ³ãƒ—ãƒ«2
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentProductData = null;

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
        document.getElementById('scrapeForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const url = document.getElementById('url').value;
            const scrapeBtn = document.getElementById('scrapeBtn');
            const errorDiv = document.getElementById('errorDiv');
            const productResult = document.getElementById('productResult');
            
            // ãƒªã‚»ãƒƒãƒˆ
            hideError();
            hideResult();
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹
            scrapeBtn.innerHTML = 'â³ å–å¾—ä¸­...';
            scrapeBtn.disabled = true;
            
            try {
                // ãƒ‡ãƒ¢ç”¨ã®ãƒ¢ãƒƒã‚¯å‡¦ç†ï¼ˆå®Ÿéš›ã®APIã¯ä½¿ç”¨ã§ããªã„ç’°å¢ƒã§ã®ä»£æ›¿ï¼‰
                if (url.includes('sample')) {
                    const mockData = getMockData(url);
                    displayResult(mockData);
                } else {
                    // å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ï¼ˆæœ¬æ¥ã®å‡¦ç†ï¼‰
                    const response = await fetch('/api/scrape', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ url }),
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.error || 'å•†å“æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }

                    displayResult(data);
                }
            } catch (err) {
                showError(err.message || 'äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            } finally {
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹è§£é™¤
                scrapeBtn.innerHTML = 'ğŸ” å•†å“æƒ…å ±ã‚’å–å¾—';
                scrapeBtn.disabled = false;
            }
        });

        // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function getMockData(url) {
            const samples = {
                'sample1': {
                    title: 'LOUIS VUITTON ãƒ¢ãƒã‚°ãƒ©ãƒ  ãƒãƒ´ã‚¡ãƒ¼ãƒ•ãƒ« MM ãƒˆãƒ¼ãƒˆãƒãƒƒã‚°',
                    image: 'https://via.placeholder.com/400x400/8B4513/FFFFFF?text=LV+Sample',
                    price: '89000',
                    description: 'ãƒ«ã‚¤ãƒ»ãƒ´ã‚£ãƒˆãƒ³ã®äººæ°—ãƒˆãƒ¼ãƒˆãƒãƒƒã‚°ã§ã™ã€‚å¤šå°‘ã®ä½¿ç”¨æ„ŸãŒã‚ã‚Šã¾ã™ãŒã€ã¾ã ã¾ã ãŠä½¿ã„ã„ãŸã ã‘ã¾ã™ã€‚',
                    brand: 'LOUIS VUITTON',
                    condition: 'ç›®ç«‹ã£ãŸå‚·ã‚„æ±šã‚Œãªã—',
                    source: 'rakuma'
                },
                'sample2': {
                    title: 'CHANEL ãƒãƒˆãƒ©ãƒƒã‚» ãƒã‚§ãƒ¼ãƒ³ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒãƒƒã‚° ãƒ–ãƒ©ãƒƒã‚¯',
                    image: 'https://via.placeholder.com/400x400/000000/FFFFFF?text=CHANEL+Sample',
                    price: '128000',
                    description: 'ã‚·ãƒ£ãƒãƒ«ã®å®šç•ªãƒãƒˆãƒ©ãƒƒã‚»ã§ã™ã€‚çŠ¶æ…‹è‰¯å¥½ã§ã€ã¾ã ã¾ã é•·ããŠä½¿ã„ã„ãŸã ã‘ã¾ã™ã€‚',
                    brand: 'CHANEL',
                    condition: 'æœªä½¿ç”¨ã«è¿‘ã„',
                    source: 'rakuma'
                }
            };
            
            const key = url.includes('sample1') ? 'sample1' : 'sample2';
            return samples[key];
        }

        // çµæœè¡¨ç¤º
        function displayResult(data) {
            currentProductData = data;
            
            document.getElementById('productTitle').textContent = data.title;
            document.getElementById('productPrice').textContent = `Â¥${parseInt(data.price).toLocaleString()}`;
            
            // ç”»åƒå‡¦ç†
            const productImage = document.getElementById('productImage');
            const noImagePlaceholder = document.getElementById('noImagePlaceholder');
            
            if (data.image) {
                productImage.src = data.image;
                productImage.classList.remove('hidden');
                noImagePlaceholder.classList.add('hidden');
            } else {
                productImage.classList.add('hidden');
                noImagePlaceholder.classList.remove('hidden');
            }

            // ã‚ªãƒ—ã‚·ãƒ§ãƒ³æƒ…å ±ã®è¡¨ç¤º
            toggleElement('brandContainer', 'productBrand', data.brand);
            toggleElement('conditionContainer', 'productCondition', data.condition);
            toggleElement('descriptionContainer', 'productDescription', data.description);
            
            document.getElementById('productResult').classList.remove('hidden');
        }

        // è¦ç´ ã®è¡¨ç¤º/éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleElement(containerId, textId, value) {
            const container = document.getElementById(containerId);
            const textElement = document.getElementById(textId);
            
            if (value && value.trim()) {
                textElement.textContent = value;
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
            }
        }

        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorDiv').classList.remove('hidden');
        }

        // ã‚¨ãƒ©ãƒ¼éè¡¨ç¤º
        function hideError() {
            document.getElementById('errorDiv').classList.add('hidden');
        }

        // çµæœéè¡¨ç¤º
        function hideResult() {
            document.getElementById('productResult').classList.add('hidden');
        }

        // ãƒ†ã‚¹ãƒˆURLè¨­å®š
        function setTestUrl(url) {
            document.getElementById('url').value = url;
        }

        // ã‚µã‚¤ãƒˆã«è¿½åŠ ãƒœã‚¿ãƒ³
        document.getElementById('addToSiteBtn').addEventListener('click', function() {
            if (currentProductData) {
                alert('ğŸ‰ å•†å“ãŒã‚µã‚¤ãƒˆã«è¿½åŠ ã•ã‚Œã¾ã—ãŸï¼\\n\\nå•†å“å: ' + currentProductData.title + '\\nä¾¡æ ¼: Â¥' + parseInt(currentProductData.price).toLocaleString() + '\\n\\nï¼ˆãƒ‡ãƒ¢æ©Ÿèƒ½ã§ã™ï¼‰');
            }
        });
    </script>
</body>
</html>